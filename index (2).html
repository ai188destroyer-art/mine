<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WorldTreats</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>

<!-- React -->
<script src="https://unpkg.com/react@17/umd/react.development.js"></script>
<script src="https://unpkg.com/react-dom@17/umd/react-dom.development.js"></script>
<script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>

<style>
/* --- Basic Styling --- */
body{margin:0;font-family:'Segoe UI',sans-serif;background:#fdf6f0;color:#333;}
header{display:flex;justify-content:space-between;align-items:center;padding:1rem;background:#fff;box-shadow:0 2px 5px rgba(0,0,0,0.1);}
header h1{color:#d6336c;font-size:1.8rem;margin:0;}
button{cursor:pointer;position:relative;transition:transform 0.2s ease, background 0.3s;}
button:hover{transform:scale(1.05);}
input,select{padding:0.5rem;border-radius:6px;border:1px solid #ccc;margin-bottom:0.5rem;transition:border 0.3s,box-shadow 0.3s;}
input:focus,select:focus{border-color:#d6336c;box-shadow:0 0 6px rgba(214,51,108,0.4);outline:none;}
footer{text-align:center;padding:1rem;background:#f0e6e0;border-radius:10px;margin-top:2rem;font-size:0.85rem;}
.container{display:flex;gap:1rem;padding:1rem;flex-wrap:wrap;}
.sidebar{width:220px;padding:1rem;background:#fff;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.05);transition: transform 0.3s;}
.sidebar h3{margin-top:0;margin-bottom:0.5rem;}
.sidebar div{margin:0.3rem 0;cursor:pointer;padding:0.4rem 0.5rem;border-radius:6px;transition: background 0.3s,transform 0.2s;}
.sidebar div:hover,.sidebar .selected{background:#f0e6e0;transform:translateX(3px);}
.sidebar input[type="range"]:hover,.sidebar button:hover{transform:scale(1.03);}
.product-grid{flex:1;display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:1rem;}
.card{border:1px solid #ccc;padding:1rem;border-radius:12px;background:#fff;text-align:center;transition:transform 0.3s,box-shadow 0.3s;}
.card:hover{transform:scale(1.05) translateY(-5px);box-shadow:0 8px 25px rgba(0,0,0,0.25);}
.card img{width:100%;height:140px;object-fit:cover;border-radius:10px;cursor:pointer;transition: transform 0.3s;}
.card img:hover{transform:scale(1.05);}
.cart{padding:1rem;border-radius:10px;background:#fff;box-shadow:0 4px 12px rgba(0,0,0,0.12);margin:1rem;animation: fadeSlide 0.3s ease;}
.cart div{display:flex;justify-content:space-between;align-items:center;padding:0.5rem 0;border-bottom:1px solid #eee;}
.cart-total{text-align:right;font-weight:bold;margin-top:0.5rem;}
@keyframes fadeSlide{from{opacity:0;transform:translateY(-10px);}to{opacity:1;transform:translateY(0);}}
.badge{position:absolute;top:-8px;right:-8px;background:#d6336c;color:#fff;border-radius:50%;width:22px;height:22px;display:flex;align-items:center;justify-content:center;font-size:0.75rem;font-weight:bold;transition: transform 0.3s ease;}
.badge.animate{animation:bounce 0.5s ease;}
@keyframes bounce{0%{transform:scale(1);}30%{transform:scale(1.6);}50%{transform:scale(0.9);}70%{transform:scale(1.2);}100%{transform:scale(1);}}
.autocomplete-suggestions{position:absolute;background:#fff;border:1px solid #ccc;border-radius:6px;max-height:150px;overflow-y:auto;z-index:10;width:calc(100% - 2px); margin-top:-1px; box-shadow:0 4px 12px rgba(0,0,0,0.1);}
.autocomplete-suggestion{padding:0.5rem;cursor:pointer;transition: background 0.3s,transform 0.2s;}
.autocomplete-suggestion:hover,.autocomplete-selected{background:#f0e6e0;transform:translateX(3px);}
.highlight{font-weight:bold;color:#d6336c;}
.modal-bg{position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;align-items:center;justify-content:center;z-index:50;opacity:0;animation: fadeInBg 0.3s forwards;}
.modal{background:#fff;padding:1rem;border-radius:12px;width:300px;max-width:90%;position: relative;transform: scale(0.9);opacity: 0;animation: scaleIn 0.3s forwards;box-shadow: 0 6px 20px rgba(0,0,0,0.25);transition: transform 0.3s;}
.modal button:hover{transform:scale(1.05);}
@keyframes fadeInBg{to{opacity:1;}}
@keyframes scaleIn{to{transform:scale(1);opacity:1;}}
.toast{position: fixed; bottom: 20px; right: 20px; background:#d6336c;color:#fff;padding:0.75rem 1.25rem;border-radius:8px;opacity:0;transform: translateY(20px);transition: all 0.4s ease;pointer-events:none;box-shadow:0 4px 12px rgba(0,0,0,0.2);}
.toast.show{opacity:1; transform: translateY(0); pointer-events:auto;}
@media(max-width:768px){.container{flex-direction:column;}.sidebar{width:100%;display:flex;flex-wrap:wrap;gap:0.5rem;justify-content:space-around;}.product-grid{grid-template-columns:repeat(auto-fit,minmax(150px,1fr));}.cart{margin:1rem 0;}}
</style>
</head>
<body>
<div id="root"></div>

<script type="text/babel">

const { useState, useEffect, useMemo } = React;

// --- Firebase Init ---
const firebaseConfig = {/* YOUR FIREBASE CONFIG */};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// --- Components ---
function ProductCard({ product, onAdd, isAdmin, onDelete }) {
  return (
    <div className="card">
      <img src={product.image} alt={product.name}/>
      <h3>{product.name}</h3>
      <p>${product.price.toFixed(2)}</p>
      <p style={{fontSize:".8rem",color:"#aaa"}}>{product.category}</p>
      <button onClick={()=>onAdd(product)}>Add to Cart</button>
      {isAdmin && <button onClick={()=>onDelete(product.id)}>Delete</button>}
    </div>
  );
}

function Sidebar({ filters,setFilters,products,suggestions,setFiltersSearch }) {
  const categories = useMemo(()=>{
    const counts = products.reduce((acc,p)=>{ acc[p.category]=(acc[p.category]||0)+1; return acc; },{});
    return counts;
  },[products]);

  return (
    <aside className="sidebar">
      <h3>Category</h3>
      <div className={filters.category==="all"?"selected":""} onClick={()=>setFilters({...filters,category:"all"})}>All ({products.length})</div>
      {Object.keys(categories).map(cat=><div key={cat} className={filters.category===cat?"selected":""} onClick={()=>setFilters({...filters,category:cat})}>{cat} ({categories[cat]})</div>)}
      <h3>Search</h3>
      <input type="text" placeholder="Search snacks..." value={filters.search} onChange={e=>setFiltersSearch(e.target.value)}/>
      {suggestions.length>0 && <div className="autocomplete-suggestions">
        {suggestions.map((s,i)=><div key={i} dangerouslySetInnerHTML={{__html:s.highlighted}} onClick={()=>setFiltersSearch(s.name)}></div>)}
      </div>}
    </aside>
  );
}

function Cart({ cart,setCart,onCheckout }) {
  const total = cart.reduce((a,c)=>a+c.price*c.qty,0).toFixed(2);
  const updateQty = (id,delta)=>setCart(prev=>prev.map(i=>i.id===id?{...i,qty:Math.max(1,i.qty+delta)}:i));
  const remove = id=>setCart(prev=>prev.filter(i=>i.id!==id));
  return (
    <div className="cart">
      <h3>Your Cart</h3>
      {cart.length===0 && <p>Cart is empty</p>}
      {cart.map(i=><div key={i.id}><span>{i.name} (${i.price} x{i.qty})</span><div>
        <button onClick={()=>updateQty(i.id,-1)}>-</button>
        <button onClick={()=>updateQty(i.id,1)}>+</button>
        <button onClick={()=>remove(i.id)}>Remove</button>
      </div></div>)}
      {cart.length>0 && <>
        <div className="cart-total">Total: ${total}</div>
        <button disabled={cart.length===0} onClick={onCheckout}>Checkout</button>
      </>}
    </div>
  );
}

function AdminPanel({addProduct,isAdmin}) {
  if(!isAdmin) return null;
  return (
    <section className="sidebar">
      <h3>Add Product</h3>
      <form onSubmit={addProduct}>
        <input name="name" placeholder="Name"/>
        <input name="price" type="number" step="0.01" placeholder="Price"/>
        <select name="category">
          <option value="chocolate">Chocolate</option>
          <option value="chips">Chips</option>
          <option value="drinks">Drinks</option>
          <option value="cookies">Cookies</option>
          <option value="candy">Candy</option>
        </select>
        <input name="image" type="file" accept="image/*"/>
        <button type="submit">Add Product</button>
      </form>
    </section>
  );
}

function App() {
  const [products,setProducts] = useState([]);
  const [cart,setCart] = useState([]);
  const [filters,setFilters] = useState({category:"all",search:""});
  const [suggestions,setSuggestions] = useState([]);
  const [isAdmin,setIsAdmin] = useState(true);

  useEffect(()=>{
    db.collection("products").onSnapshot(snap=>setProducts(snap.docs.map(doc=>({id:doc.id,...doc.data()}))));
  },[]);

  const filteredProducts = useMemo(()=>{
    return products.filter(p=>{
      return (filters.category==="all"||p.category===filters.category)
        && p.name.toLowerCase().includes(filters.search.toLowerCase());
    });
  },[products,filters]);

  useEffect(()=>{
    if(!filters.search){setSuggestions([]);return;}
    const regex = new RegExp(`(${filters.search})`,'i');
    const s = products.filter(p=>regex.test(p.name)).slice(0,5).map(p=>({name:p.name,highlighted:p.name.replace(regex,'<span class="highlight">$1</span>')}));
    setSuggestions(s);
  },[filters.search,products]);

  const addToCart = (p)=>setCart(prev=>{const exist=prev.find(i=>i.id===p.id);return exist?prev.map(i=>i.id===p.id?{...i,qty:i.qty+1}:i):[...prev,{...p,qty:1}]});

  const checkout = ()=>{
    if(cart.length===0)return;
    // EmailJS integration can go here
    alert("Order placed! EmailJS integration here.");
    setCart([]);
  };

  const addProduct = async(e)=>{
    e.preventDefault();
    const name=e.target.name.value.trim();
    const price=parseFloat(e.target.price.value);
    const category=e.target.category.value;
    const file=e.target.image.files[0];
    if(!name||!price||!category||!file) return alert("Fill all fields.");
    try {
      const ref = storage.ref().child(`products/${Date.now()}_${file.name}`);
      await ref.put(file);
      const imageUrl = await ref.getDownloadURL();
      await db.collection("products").add({name,price,category,image:imageUrl});
      e.target.reset();
    } catch(err){alert("Upload failed: "+err.message);}
  };

  const deleteProduct = async(id)=>{await db.collection("products").doc(id).delete();};

  return (
    <>
      <header>
        <h1>WorldTreats</h1>
        <div style={{position:"relative"}}>
          <button>Cart</button>
          {cart.length>0 && <div className="badge">{cart.length}</div>}
        </div>
      </header>
      <div className="container">
        <Sidebar filters={filters} setFilters={setFilters} products={products} suggestions={suggestions} setFiltersSearch={val=>setFilters({...filters,search:val})}/>
        <div className="product-grid">
          {filteredProducts.map(p=><ProductCard key={p.id} product={p} onAdd={addToCart} isAdmin={isAdmin} onDelete={deleteProduct}/>)}
        </div>
        <Cart cart={cart} setCart={setCart} onCheckout={checkout}/>
        <AdminPanel addProduct={addProduct} isAdmin={isAdmin}/>
      </div>
      <footer>© 2025 WorldTreats. All rights reserved.</footer>
    </>
  );
}

ReactDOM.render(<App/>,document.getElementById("root"));

</script>
</body>
</html>

